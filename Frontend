<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Personalized Learning & Skill-Gap Analysis</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    body { font-family: 'Inter', sans-serif; }
    .glass {
      backdrop-filter: blur(10px);
      background-color: rgba(255, 255, 255, 0.1);
    }
    .card-hover:hover {
      transform: scale(1.05);
      transition: transform 0.3s ease-in-out;
    }
    .glow { box-shadow: 0 0 10px rgba(255,255,255,0.2); }
  </style>
</head>
<body class="bg-gradient-to-r from-blue-400 to-purple-500 min-h-screen text-white">

  <!-- Header -->
  <header class="flex justify-between items-center p-5 glass rounded-lg shadow-xl mx-4 mt-4 glow">
    <div class="flex items-center space-x-4">
      <img src="https://placehold.co/100x50" alt="Logo" class="rounded shadow"/>
      <nav class="space-x-4 text-white font-medium">
        <a href="#" class="hover:underline transition">Home</a>
        <a href="#" class="hover:underline transition">My Learning</a>
        <a href="#" class="hover:underline transition">Assessments</a>
        <a href="#" class="hover:underline transition">Skill Gaps</a>
        <a href="#" class="hover:underline transition">Reports</a>
      </nav>
    </div>
    <div class="flex items-center space-x-4">
      <input type="text" placeholder="Search skills..." class="p-2 rounded bg-gray-700 text-white focus:ring-2 focus:ring-blue-300"/>
      <div class="relative group">
        <i class="fas fa-bell text-white text-lg cursor-pointer">
          <span class="absolute top-[-8px] right-[-6px] bg-red-500 text-xs rounded-full px-1">3</span>
        </i>
        <span class="absolute top-6 text-sm hidden group-hover:block bg-black bg-opacity-60 px-2 py-1 rounded">Notifications</span>
      </div>
      <img src="https://placehold.co/40x40" alt="Profile" class="rounded-full border-2 border-white shadow"/>
    </div>
  </header>

  <!-- Main Content -->
  <main class="p-6">
    <!-- Greeting -->
    <section class="my-8">
      <h1 class="text-4xl font-bold">Hi <span id="userName">Loading...</span>, ready to close your skill gaps today? ðŸŽ¯</h1>
      <p class="text-xl mt-2">You're <span id="progressPercent" class="font-semibold">0%</span> closer to becoming a <span id="targetRole" class="text-yellow-300">Loading...</span>.</p>
      <div class="w-32 h-32 rounded-full bg-gray-900 flex items-center justify-center text-3xl mt-6 border-8 border-green-400 shadow-lg glow" id="progressCircle">
        0%
      </div>
    </section>

    <!-- Learning Path -->
    <section class="my-8">
      <h2 class="text-2xl font-semibold mb-4">ðŸš€ Current Learning Path</h2>
      <div id="learningPathContainer" class="flex space-x-6 overflow-x-auto pb-4">
        <!-- Learning path cards will be loaded here -->
      </div>
    </section>

    <!-- Progress Tracker -->
    <section class="my-8">
      <h2 class="text-2xl font-semibold mb-4">ðŸ“Š AI Progress Tracker</h2>
      <div id="progressStages" class="flex flex-wrap gap-6">
        <!-- Progress stages will load dynamically -->
      </div>
    </section>

    <!-- Recommendations -->
    <section class="my-8">
      <h2 class="text-2xl font-semibold mb-4">âœ¨ Smart Recommendations</h2>
      <div id="recommendationsContainer" class="flex space-x-6 overflow-x-auto pb-4">
        <!-- Recommendations will be loaded here -->
      </div>
    </section>

    <!-- Skill Chart -->
    <section class="my-8">
      <h2 class="text-2xl font-semibold mb-4">ðŸ“ˆ Skill Gap Visualizer</h2>
      <div class="bg-gray-900 p-6 rounded-xl glow">
        <p class="text-center text-gray-400">Skill chart placeholder (can be implemented with Chart.js)</p>
      </div>
    </section>

    <!-- Ask AI Section -->
    <section class="my-8 bg-gray-900 p-6 rounded-xl glass shadow-xl glow">
      <h2 class="text-xl font-semibold mb-3">ðŸ¤– Ask AI for Help</h2>
      <input type="text" id="aiQuery" placeholder="Ask something..." class="w-full p-2 rounded bg-gray-700 text-white mb-3"/>
      <button onclick="askAI()" class="bg-green-500 px-4 py-2 rounded hover:bg-green-600">Ask AI</button>
      <div class="mt-4 text-yellow-300" id="aiResponse"></div>
    </section>
  </main>

  <script>
    // âœ… Backend URL
    const BACKEND = "http://127.0.0.1:8000";

    // âœ… Fetch Profile Data from Backend
    function loadProfile() {
      fetch(`${BACKEND}/api/profile/1`)
        .then(res => res.json())
        .then(data => {
          // Fill greeting info
          document.getElementById("userName").innerText = data.name;
          document.getElementById("progressPercent").innerText = data.progress + "%";
          document.getElementById("targetRole").innerText = data.targetRole;
          document.getElementById("progressCircle").innerText = data.progress + "%";

          // Load learning path
          let lpHTML = "";
          data.learningPath.forEach(item => {
            lpHTML += `
              <div class="bg-gray-900 glass rounded-xl p-4 min-w-[250px] card-hover glow">
                <img src="https://placehold.co/250x120" class="rounded mb-2" />
                <div class="flex justify-between items-center">
                  <span class="text-xs bg-blue-600 px-2 py-1 rounded-full">${item.category}</span>
                  <i class="fas fa-info-circle text-yellow-400" title="${item.status}"></i>
                </div>
                <h3 class="font-bold mt-2 text-lg">${item.title}</h3>
                <p class="text-sm text-gray-300">Difficulty: ${item.difficulty}</p>
                <div class="bg-gray-600 h-2 rounded-full my-2">
                  <div class="bg-green-500 h-full rounded-full" style="width: ${item.progress}%"></div>
                </div>
                <button class="bg-gradient-to-r from-blue-500 to-indigo-500 rounded px-4 py-2 mt-2 hover:opacity-90">Continue</button>
              </div>
            `;
          });
          document.getElementById("learningPathContainer").innerHTML = lpHTML;

          // Load progress stages
          let stageHTML = "";
          data.progressStages.forEach(stage => {
            stageHTML += `
              <div class="flex items-center space-x-2">
                <i class="fas ${stage.completed ? 'fa-check-circle text-green-400' : 'fa-hourglass-half text-yellow-300'}"></i>
                <span>${stage.name}</span>
              </div>
            `;
          });
          document.getElementById("progressStages").innerHTML = stageHTML;

          // Load recommendations
          let recHTML = "";
          data.recommendations.forEach(rec => {
            recHTML += `
              <div class="bg-gray-900 glass rounded-xl p-4 min-w-[250px] card-hover glow">
                <img src="https://placehold.co/250x120" class="rounded mb-2"/>
                <h3 class="font-bold text-lg">${rec.title}</h3>
                <p class="text-sm text-gray-300 mb-2">${rec.reason}</p>
                <div class="flex gap-2">
                  <button class="bg-green-500 rounded px-3 py-1 text-sm hover:bg-green-600">Start Now</button>
                  <button class="bg-gray-700 rounded px-3 py-1 text-sm hover:bg-gray-600">Save</button>
                </div>
              </div>
            `;
          });
          document.getElementById("recommendationsContainer").innerHTML = recHTML;

        })
        .catch(err => console.error("Error loading profile:", err));
    }

    // âœ… Ask AI Function
    async function askAI() {
      const query = document.getElementById("aiQuery").value;
      document.getElementById("aiResponse").innerText = "Thinking...";
      const res = await fetch(`${BACKEND}/api/ask_ai`, {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({query})
      });
      const data = await res.json();
      document.getElementById("aiResponse").innerText = data.answer;
    }

    // âœ… Load profile on page load
    window.onload = loadProfile;
  </script>
</body>
</html>
